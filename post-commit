#!/usr/bin/env bash
export push_lock="push.lock"
push(){
  cd "${outgoing_dir}"
  until git push --quiet --no-verify origin "${push_branch}"; do
    git pull --rebase --quiet --no-verify origin "${push_branch}"
  done
}
export -f push

[[ -e "${push_lock}" ]] || touch "${push_lock}"
flock -x "${push_lock}" -c push &
